
######################################################################################
# Bootstrap marker file should not exist on Bastion before proceeding to TLS bootstrap
# It would mean that bootstrap TLS has already been applied
######################################################################################
- name: Check if bootstrap TLS marker exists on Bastion
  stat:
    path: "{{ bastion_tls_dir }}/BOOTSTRAP_COMPLETE"
  register: bootstrap_marker
  changed_when: false


- name: Fail if bootstrap TLS has already been applied
  fail:
    msg: >
      Bootstrap TLS marker found on Bastion.
      This playbook is intentionally one-time and must not be rerun.
  when: bootstrap_marker.stat.exists