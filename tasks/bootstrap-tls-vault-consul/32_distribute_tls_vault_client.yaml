###############################################################################
# Distribute Vault client TLS material (Vault â†’ Consul)
###############################################################################

- name: Ensure Vault TLS directory exists
  file:
    path: "{{ vault_tls_dir }}/consul-client"
    state: directory
    owner: vault
    group: vault
    mode: "0750"


- name: Copy Vault client certificate
  copy:
    src: "{{ bootstrap_tls_dir }}/clients/vault/client.pem"
    dest: "{{ vault_tls_dir }}/consul-client/client.pem"
    owner: vault
    group: vault
    mode: "0644"
    remote_src: yes
  delegate_to: "{{ bastion_primary_host }}"


- name: Copy Vault client private key
  copy:
    src: "{{ bootstrap_tls_dir }}/clients/vault/client.key"
    dest: "{{ vault_tls_dir }}/consul-client/client.key"
    owner: vault
    group: vault
    mode: "0600"
    remote_src: yes
  delegate_to: "{{ bastion_primary_host }}"