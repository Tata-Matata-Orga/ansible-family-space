ansible_user: ansible
become: false
# DNS

dns_entries:
  # later for HA should be changed to load balancer in front of Vault nodes
  vault:
    host: "{{ groups['vault'][0] }}"
    names:
    - "{{ vault_service_name }}"

  consul:
    # for Consul it doesn't matter which node we point to since they replicate data among themselves
    host: "{{ groups['consul_servers'][0] }}"
    names:
    - "{{ consul_service_name }}"

#ensure single canonical bastion host in case of future HA setups and accidental multiple assignments of bastion_primary
bastion_primary_host: >-
  {{
    groups['bastion']
    | select('extract', hostvars, 'bastion_primary')
    | list
    | first
  }}

### Common TLS paths used by both Vault and Consul ###

ca_cert_file: ca.pem
ca_key_file: ca.key

consul_client_key_file: consul-client.key
consul_client_cert_file: consul-client.pem

vault_client_key_file: vault-client.key
vault_client_cert_file: vault-client.pem

######################################################
######### Consul  ####################################
######################################################
consul_service_name: "consul.service.internal"

# Address advertised by the Consul agent for client access
# HTTP/HTTPS API
# used by Vault, Bastion, kubectl plugins, etc.
consul_api_addr: "{{ consul_agent_api_scheme }}://{{ consul_service_name }}: {{ consul_agent_api_port }}"

# Port of the Consul agent API (8501 = HTTPS, 8500 = HTTP)
consul_http_port: 8500
consul_https_port: 8501
consul_dns_port: 8600
consul_agent_api_port: "{{ consul_https_port if consul_tls_enabled else consul_http_port }}"

# HTTP or HTTPS depending on TLS phase
consul_agent_api_scheme: "{{ 'https' if consul_tls_enabled else 'http' }}"

# TLS lifecycle flag (flipped by bootstrap-tls playbook via set_fact)
consul_tls_enabled: false

consul_api_health_path: /v1/agent/self
consul_api_leader_path: /v1/status/leader

######################################################
######### Vault  #####################################
######################################################
vault_service_name: "vault.service.internal"

vault_api_port: 8200
vault_cluster_port: 8201

vault_api_health_path: /v1/sys/health

# TLS lifecycle flag (flipped by bootstrap-tls playbook via set_fact)
vault_tls_enabled: false

# HTTP or HTTPS depending on TLS phase
vault_api_scheme: "{{ 'https' if vault_tls_enabled else 'http' }}"

vault_api_addr: "{{ vault_api_scheme }}://{{ vault_service_name }}:{{ vault_api_port }}"
vault_cluster_addr: "{{ vault_api_scheme }}://{{ ansible_default_ipv4.address }}:{{ vault_cluster_port}}"

######################################################
######### Consul-Vault  ##############################
######################################################

#key prefix inside Consulâ€™s KV store where Vault data will be stored
vault_prefix_in_consul_store: "vault/"
