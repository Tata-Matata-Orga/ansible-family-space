#ensure single canonical bastion host in case of future HA setups and accidental multiple assignments of bastion_primary
bastion_primary_host: >-
  {{
    groups['bastion']
    | select('extract', hostvars, 'bastion_primary')
    | list
    | first
  }}


######################################################
######### Consul  ####################################
######################################################
# Address advertised by the Consul agent for client access
# HTTP/HTTPS API
# used by Vault, Bastion, kubectl plugins, etc.
consul_client_addr: "{{ hostvars[groups['consul'][0]].ansible_host }}"

# Port of the Consul agent API 
consul_agent_api_port: 8500

# HTTP or HTTPS depending on TLS phase
consul_agent_api_scheme: "{{ 'https' if consul_agent_tls_enabled else 'http' }}"

# TLS lifecycle flag (flipped by bootstrap-tls playbook via set_fact)
consul_agent_tls_enabled: false


######################################################
######### Vault  #####################################
######################################################

vault_api_port: 8200
vault_cluster_port: 8201

vault_api_health_path: /v1/sys/health

# HTTP or HTTPS depending on TLS phase
vault_agent_api_scheme: "{{ 'https' if vault_agent_tls_enabled else 'http' }}"

vault_api_addr: "{{ vault_agent_api_scheme }}://{{ ansible_default_ipv4.address }}:{{ vault_api_port }}"
vault_cluster_addr: "{{ vault_agent_api_scheme }}://{{ ansible_default_ipv4.address }}:{{ vault_cluster_port}}"

# TLS lifecycle flag (flipped by bootstrap-tls playbook via set_fact)
vault_agent_tls_enabled: false

######################################################
######### Consul-Vault  ##############################
######################################################

consul_addr_that_vault_connects_to: "{{ consul_client_addr }}"
consul_port_that_vault_connects_to: "{{ consul_agent_api_port }}"

#key prefix inside Consulâ€™s KV store where Vault data will be stored
vault_prefix_in_consul_store: "vault/"


